# Production Environment Values
# IMPORTANT: Use proper secret management in production
# Use Kubernetes Secrets, Sealed Secrets, or External Secrets Operator

kong:
  enabled: true
  proxy:
    type: LoadBalancer
  env:
    database: "off"

  # JWT Authentication Configuration (shared across all services)
  jwt:
    enabled: true
    secret: ""  # MUST be set via external secret manager in production

postgresql-user:
  enabled: true
  auth:
    password: ""
    existingSecret: "user-db-secret"
  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: ""
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

postgresql-accommodation:
  enabled: true
  auth:
    password: ""
    existingSecret: "accommodation-db-secret"
  primary:
    persistence:
      enabled: true
      size: 20Gi
      storageClass: ""
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

mongodb:
  enabled: true
  architecture: replicaset
  replicaCount: 3
  auth:
    rootPassword: ""
    password: ""
    existingSecret: "mongodb-secret"
  persistence:
    enabled: true
    size: 15Gi
    storageClass: ""
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true

user-service:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/tehnotrube/trubanb-pipeline-prod
    tag: "v1.0.0"
    pullPolicy: Always
  service:
    port: 3000
  livenessProbe:
    httpGet:
      path: /api/users/health
      port: 3000
  readinessProbe:
    httpGet:
      path: /api/users/health
      port: 3000

  # JWT Configuration - MUST use external secret manager in production
  jwt:
    secret: ""  # Will be overridden by external secret

  database:
    existingSecret: "user-db-secret"

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  ingress:
    jwtEnabled: true  # Enable JWT protection for this service
    publicEnabled: true  # Enable public routes (login, register, health)
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      konghq.com/strip-path: "false"
      konghq.com/preserve-host: "true"
    hosts:
      - host: api.trubanb.com
        paths:
          - path: /api/users
            pathType: Prefix
    tls:
      - secretName: trubanb-api-tls
        hosts:
          - api.trubanb.com

  # Production environment variables
  extraEnv:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "3000"
    - name: CORS_ORIGIN
      value: "https://trubanb.com,https://www.trubanb.com"

accommodation-service:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/tehnotrube/trubanb-pipeline-prod
    tag: "v1.0.0"
    pullPolicy: Always
  service:
    port: 3001
  livenessProbe:
    httpGet:
      path: /api/accommodations/health
      port: 3001
  readinessProbe:
    httpGet:
      path: /api/accommodations/health
      port: 3001
  database:
    existingSecret: "accommodation-db-secret"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  ingress:
    enabled: true
    jwtEnabled: true  # Enable JWT protection for this service
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      konghq.com/strip-path: "false"
      konghq.com/preserve-host: "true"
    hosts:
      - host: api.trubanb.com
        paths:
          - path: /api/accommodations
            pathType: Prefix
    tls:
      - secretName: trubanb-api-tls
        hosts:
          - api.trubanb.com
  extraEnv:
    - name: STORAGE_BUCKET
      value: "trubanb-accommodation-images-prod"
    - name: STORAGE_REGION
      value: "us-east-1"

rating-service:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/tehnotrube/trubanb-pipeline-prod
    tag: "v1.0.0"
    pullPolicy: Always
  service:
    port: 3001
  livenessProbe:
    httpGet:
      path: /api/ratings/health
      port: 3001
  readinessProbe:
    httpGet:
      path: /api/ratings/health
      port: 3001
  mongodb:
    existingSecret: "mongodb-secret"
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  ingress:
    enabled: true
    jwtEnabled: true  # Enable JWT protection for this service
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      konghq.com/strip-path: "false"
      konghq.com/preserve-host: "true"
    hosts:
      - host: api.trubanb.com
        paths:
          - path: /api/ratings
            pathType: Prefix
    tls:
      - secretName: trubanb-api-tls
        hosts:
          - api.trubanb.com

notification-service:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/tehnotrube/trubanb-notification-service
    tag: "v1.0.0"
    pullPolicy: Always
  service:
    port: 3001
  livenessProbe:
    httpGet:
      path: /api/notifications/health
      port: 3001
  readinessProbe:
    httpGet:
      path: /api/notifications/health
      port: 3001
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  ingress:
    enabled: true
    jwtEnabled: true  # Enable JWT protection for this service
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      konghq.com/strip-path: "false"
      konghq.com/preserve-host: "true"
    hosts:
      - host: api.trubanb.com
        paths:
          - path: /api/notifications
            pathType: Prefix
    tls:
      - secretName: trubanb-api-tls
        hosts:
          - api.trubanb.com

  # Production environment variables
  extraEnv:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "3001"
    # SMTP configuration should use external secrets in production
    # - name: SMTP_HOST
    #   valueFrom:
    #     secretKeyRef:
    #       name: notification-secrets
    #       key: smtp-host
    # - name: SMTP_PORT
    #   valueFrom:
    #     secretKeyRef:
    #       name: notification-secrets
    #       key: smtp-port
