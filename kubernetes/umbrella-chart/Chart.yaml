apiVersion: v2
name: trubanb
description: Umbrella chart for trubanb microservices platform
type: application
version: 0.1.0
appVersion: "1.0"

dependencies:
  # Kong API Gateway
  - name: kong
    version: "2.38.0"
    repository: https://charts.konghq.com
    condition: kong.enabled
  
  # PostgreSQL for user-service
  - name: postgresql
    version: "18.2.0"
    repository: oci://registry-1.docker.io/bitnamicharts
    condition: postgresql-user.enabled
    alias: postgresql-user

  # PostgreSQL for accommodation-service
  - name: postgresql
    version: "18.2.0"
    repository: oci://registry-1.docker.io/bitnamicharts
    condition: postgresql-accommodation.enabled
    alias: postgresql-accommodation

  # PostgreSQL for reservation-service
  - name: postgresql
    version: "18.2.0"
    repository: oci://registry-1.docker.io/bitnamicharts
    condition: postgresql-reservation.enabled
    alias: postgresql-reservation

  # MongoDB for rating-service
  - name: mongodb
    version: "18.1.20"
    repository: oci://registry-1.docker.io/bitnamicharts
    condition: mongodb-rating.enabled
    alias: mongodb-rating

  # MongoDB for notification-service
  - name: mongodb
    version: "18.1.20"
    repository: oci://registry-1.docker.io/bitnamicharts
    condition: mongodb-notification.enabled
    alias: mongodb-notification

  # MinIO for accommodation-service (photo storage)
  - name: minio
    version: "0.9.2"
    repository: oci://registry-1.docker.io/cloudpirates
    condition: minio.enabled

  # RabbitMQ for message broker
  - name: rabbitmq
    version: "0.15.3"
    repository: oci://registry-1.docker.io/cloudpirates
    condition: rabbitmq.enabled

  # User Service
  - name: user-service
    version: "0.1.0"
    repository: "file://../service-charts/user-service"
    condition: user-service.enabled
  
  # Accommodation Service
  - name: accommodation-service
    version: "0.1.0"
    repository: "file://../service-charts/accommodation-service"
    condition: accommodation-service.enabled

  # Reservation Service
  - name: reservation-service
    version: "0.1.0"
    repository: "file://../service-charts/reservation-service"
    condition: reservation-service.enabled

  # Rating Service
  - name: rating-service
    version: "0.1.0"
    repository: "file://../service-charts/rating-service"
    condition: rating-service.enabled

  # Notification Service
  - name: notification-service
    version: "0.1.0"
    repository: "file://../service-charts/notification-service"
    condition: notification-service.enabled

  # Frontend (React + nginx)
  - name: frontend
    version: "0.1.0"
    repository: "file://../service-charts/frontend"
    condition: frontend.enabled

  # ============================================================================
  # OBSERVABILITY STACK
  # ============================================================================

  # Prometheus Stack (includes Prometheus, Alertmanager, Grafana, node-exporter)
  - name: kube-prometheus-stack
    version: "67.4.0"
    repository: https://prometheus-community.github.io/helm-charts
    condition: kube-prometheus-stack.enabled

  # Loki - Log aggregation
  - name: loki
    version: "6.24.0"
    repository: https://grafana.github.io/helm-charts
    condition: loki.enabled

  # Promtail - Log collector (ships logs to Loki)
  - name: promtail
    version: "6.16.6"
    repository: https://grafana.github.io/helm-charts
    condition: promtail.enabled

  # Jaeger - Distributed tracing
  - name: jaeger
    version: "3.4.1"
    repository: https://jaegertracing.github.io/helm-charts
    condition: jaeger.enabled
